<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Veda v kocke ‚Äî Tri kv√≠zy (BIO / FYZ / CHE)</title>
  <meta name="description" content="Interakt√≠vny kv√≠z Veda v kocke ‚Äî Biol√≥gia, Fyzika, Ch√©mia. Futuristick√Ω vzhƒæad, progres a ukladanie v√Ωsledkov podƒæa e‚Äëmailu." />

  <style>
    /* =========================================================
       T√âMA / VZHƒΩAD ‚Äî Futuristick√Ω tmav√Ω ≈°t√Ωl (neon blue/purple/pink)
       Jemn√© okraje, dobr√Ω kontrast, pr√≠stupnos≈•, responzivita
       ========================================================= */
    :root{
      --bg1:#070b1a;
      --bg2:#0e1533;
      --text:#eaf3ff;
      --muted:#9fb3d7;

      --cyan:#72d2ff;
      --pink:#ff7ad9;
      --green:#5cff94;
      --blue:#6aa8ff;
      --purple:#b792ff;

      --card: rgba(16, 22, 52, .78);
      --glass-border: rgba(255,255,255,.08);
      --radius:20px;
      --shadow: 0 12px 48px rgba(0,0,0,.45), 0 0 64px rgba(114,210,255,.12);
      --right:#2ecc71;
      --wrong:#ff5b5b;
    }

    *{ box-sizing:border-box }
    html,body{ height:100% }
    body{
      margin:0;
      color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Noto Sans", "Helvetica Neue", Arial;
      background:
        radial-gradient(1200px 700px at 15% -10%, #1c2f7f 0%, transparent 60%),
        radial-gradient(900px 600px at 85% 0%, #4a176b 0%, transparent 55%),
        radial-gradient(1200px 800px at 50% 110%, #0c3850 0%, transparent 65%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      background-attachment: fixed;
      overflow-x:hidden;
    }

    /* hviezdny ≈°um */
    body::before{
      content:""; position:fixed; inset:0; z-index:-1;
      background-image:
        radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,.6) 40%, transparent 41%),
        radial-gradient(1.5px 1.5px at 60% 70%, rgba(255,255,255,.45) 40%, transparent 41%),
        radial-gradient(1.2px 1.2px at 80% 20%, rgba(255,255,255,.35) 40%, transparent 41%),
        radial-gradient(1px 1px at 30% 80%, rgba(255,255,255,.25) 40%, transparent 41%);
      opacity:.55; pointer-events:none;
    }

    .container{
      max-width:1080px; margin:24px auto; padding:16px;
    }

    .card{
      background:var(--card);
      border:1px solid var(--glass-border);
      border-radius:var(--radius);
      backdrop-filter: blur(10px) saturate(115%);
      -webkit-backdrop-filter: blur(10px) saturate(115%);
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    header.app{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:16px 20px; border-bottom:1px solid var(--glass-border);
      background:
        linear-gradient(90deg, rgba(114,210,255,.12), transparent 45%),
        linear-gradient(270deg, rgba(255,122,217,.08), transparent 55%);
    }
    .brand{ display:flex; align-items:center; gap:12px }
    .logo{
      width:44px; height:44px; border-radius:14px; display:grid; place-items:center;
      background: radial-gradient(circle at 30% 30%, #1bffb1, #2a6fff 70%);
      box-shadow:0 0 22px rgba(114,210,255,.45), inset 0 0 22px rgba(92,255,148,.35);
      color:#061019; font-weight:900;
    }
    .brand h1{ font-size:1.25rem; margin:0 }
    .sub{ color:var(--muted); font-size:.9rem }

    .sources-btn{
      position:fixed; top:18px; right:18px; z-index:5;
      border:1px solid var(--glass-border); background: rgba(10,14,34,.6);
      color:var(--text); border-radius:999px; padding:10px 14px; cursor:pointer;
      font-weight:700;
      box-shadow: 0 8px 24px rgba(0,0,0,.35);
    }
    .sources-btn:hover{ transform: translateY(-1px) }

    main{ padding:20px }

    /* ============ HOME obrazovka ============ */
    .home{
      display:grid; gap:18px;
    }

    .intro{
      padding:18px; border-radius:18px;
      background: linear-gradient(180deg, rgba(114,210,255,.06), rgba(255,122,217,.05));
    }

    .email-row{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center;
    }
    label[for=email]{ font-weight:700 }
    input[type=email]{
      flex:1 1 260px; min-width:220px;
      padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.1);
      background:#0c1335; color:var(--text); outline:none;
      box-shadow: inset 0 0 0 1px rgba(114,210,255,.08);
    }
    .btn{
      padding:12px 16px; border:none; border-radius:12px; font-weight:800; cursor:pointer; color:#061019;
      background:linear-gradient(90deg, var(--cyan), #9be0ff);
      box-shadow:0 10px 24px rgba(114,210,255,.35), inset 0 -2px 0 rgba(0,0,0,.25);
      transition: transform .06s ease, box-shadow .2s;
    }
    .btn:hover{ transform: translateY(-1px) }
    .btn.ghost{ background: transparent; color:var(--text); border:1px solid rgba(255,255,255,.18) }
    .btn.small{ padding:8px 10px; font-size:.9rem }

    /* Port√°ly (3 kateg√≥rie) */
    .portals{
      display:grid; grid-template-columns: repeat(3, 1fr); gap:16px;
    }
    @media (max-width:880px){ .portals{ grid-template-columns:1fr } }
    .portal{
      position:relative; overflow:hidden; border-radius:20px; padding:16px;
      border:1px solid var(--glass-border);
      background: rgba(8,12,30,.6);
      min-height:160px; display:flex; align-items:center; gap:18px;
      cursor:pointer;
      outline:none;
    }
    .portal[aria-disabled="true"]{ opacity:.6; cursor:not-allowed }
    .p-ring{
      position:absolute; inset: -20% -10% -20% auto; width:260px; height:260px; border-radius:50%;
      filter: blur(24px) saturate(140%);
      animation: pulse 4.8s ease-in-out infinite;
      opacity:.8;
    }
    .portal .info{ position:relative; z-index:1 }
    .portal h3{ margin:0 0 6px; font-size:1.35rem }
    .k-label{ font-size:.9rem; opacity:.9 }
    .status-badge{
      margin-top:10px; display:inline-flex; align-items:center; gap:8px; padding:6px 10px;
      border-radius:999px; font-size:.85rem; font-weight:800;
      background:linear-gradient(90deg,#D1D9E6,#F1F4F8); color:#29303a;
    }
    .status-badge.done{ background:linear-gradient(90deg,#a0ffcf,#72d2ff); color:#0a1c1c }
    .lock{
      position:absolute; top:12px; right:12px; z-index:1;
      font-weight:900; padding:6px 8px; border-radius:10px; font-size:.8rem;
      color:#061019; background:linear-gradient(90deg,#ffc1c1,#ff9aa9); display:none;
    }
    .portal.done .lock{ display:block }

    @keyframes pulse{
      0%,100%{ transform: scale(1); opacity:.75 }
      50%{ transform: scale(1.07); opacity:1 }
    }

    /* farby port√°lov: BIO (green), FYZ (blue), CHE (purple) */
    .ring-bio{ background: radial-gradient(closest-side, rgba(92,255,148,.4), transparent 60%), conic-gradient(#39f79c, #39c5f7, #39f79c) }
    .ring-fyz{ background: radial-gradient(closest-side, rgba(114,210,255,.35), transparent 60%), conic-gradient(#67a8ff, #7fd2ff, #67a8ff) }
    .ring-che{ background: radial-gradient(closest-side, rgba(183,146,255,.35), transparent 60%), conic-gradient(#b792ff, #ff7ad9, #b792ff) }

    /* Panel priebehu pre zadan√Ω e‚Äëmail */
    .progress-panel{
      margin-top:8px; padding:14px; border-radius:16px; border:1px solid var(--glass-border);
      background: rgba(10,14,34,.55);
      display:grid; gap:6px; font-size:.98rem;
    }

    /* ============ KV√çZ obrazovka ============ */
    .screen{ display:none }
    .screen.active{ display:block }

    .qwrap{ display:grid; gap:18px }
    .qhead{ display:flex; align-items:flex-end; justify-content:space-between; gap:10px }
    .qtitle{
      font-size:1.35rem; font-weight:900; line-height:1.35; letter-spacing:.2px;
      color:#fff; text-shadow:0 2px 8px rgba(0,0,0,.35);
    }
    .meter{
      height:12px; border-radius:999px; background:rgba(255,255,255,.08);
      box-shadow: inset 0 1px 2px rgba(0,0,0,.25); overflow:hidden;
    }
    .meter .fill{
      height:100%; width:0%;
      background: linear-gradient(90deg, #72d2ff, #5cff94);
      box-shadow: 0 0 18px rgba(114,210,255,.35);
      transition: width .35s ease;
    }
    .step{
      font-size:.95rem; color:var(--muted)
    }

    .answers{ display:grid; gap:12px }
    .answers.two{ grid-template-columns:1fr 1fr; }
    @media (max-width:560px){ .answers.two{ grid-template-columns:1fr } }

    .opt{
      text-align:left; padding:14px; border-radius:14px; border:1px solid rgba(255,255,255,.1);
      background:#0e1536; cursor:pointer; position:relative; overflow:hidden; display:flex; align-items:center; justify-content:flex-start;
      color:#fff; /* ƒçitateƒæn√Ω biely text */
    }
    .opt:focus{ outline:2px solid var(--cyan) }
    .opt span.key{
      display:inline-grid; place-items:center; width:28px; height:28px; border-radius:8px; margin-right:12px; font-weight:900; color:#061019;
      background:linear-gradient(180deg,#e7f6ff,#72d2ff)
    }
    .opt.big{ padding:22px 20px; text-align:center; font-size:1.25rem; justify-content:center; font-weight:900 }
    /* √ÅNO/NIE ‚Äì dve veƒæk√© tlaƒçidl√° s implicitn√Ωmi odtie≈àmi */
    .answers.two .opt.big:first-child{ background:linear-gradient(180deg,#0c2a1b,#0b1f17); border:2px solid rgba(92,255,148,.35) }
    .answers.two .opt.big:last-child{  background:linear-gradient(180deg,#2a0c12,#1a0b14); border:2px solid rgba(255,107,107,.35) }
    .answers.two .opt.big span.key{ display:none } /* ≈æiadny mal√Ω ≈°t√≠tok pri √ÅNO/NIE */

    .opt.correct{ border-color: rgba(92,255,148,.9) !important; box-shadow:0 0 0 3px rgba(92,255,148,.25), 0 0 22px rgba(92,255,148,.25) }
    .opt.wrong{   border-color: rgba(255,91,91,.9) !important;  box-shadow:0 0 0 3px rgba(255,91,91,.2), 0 0 22px rgba(255,91,91,.2) }
    .opt.correct::after, .opt.wrong::after{
      content: attr(data-tag); position:absolute; right:10px; top:10px;
      font-size:.8rem; font-weight:900; padding:4px 8px; border-radius:999px; color:#061019;
    }
    .opt.correct::after{ background:linear-gradient(90deg,#a0ffcf,#6cd2ff) }
    .opt.wrong::after{   background:linear-gradient(90deg,#ffc1c1,#ff9aa9) }

    .explain{
      display:none; margin-top:6px; padding:14px; border-radius:14px; background:rgba(114,210,255,.06);
      border:1px solid var(--glass-border);
    }
    .explain.active{ display:block }

    .qfooter{ display:flex; gap:10px; justify-content:space-between; align-items:center }
    .score{ color:var(--muted) }

    /* ============ MOD√ÅLY (intro + v√Ωsledok + zdroje) ============ */
    .modal{
      position:fixed; inset:0; background:rgba(2,4,12,.65);
      display:none; align-items:center; justify-content:center; padding:24px; z-index:10;
    }
    .modal.active{ display:flex }
    .modal .box{
      width:min(720px, 100%); background:var(--card); border:1px solid var(--glass-border);
      border-radius:18px; box-shadow:var(--shadow); padding:18px;
    }
    .modal .box h2{ margin-top:6px }
    .close-x{ position:absolute; right:18px; top:18px; border:none; background:transparent; color:var(--text); font-weight:900; cursor:pointer }

    .tier{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; font-weight:800; background:linear-gradient(90deg,#FFD166,#FFE29A); color:#432d00 }
    .silver{ background:linear-gradient(90deg,#D1D9E6,#F1F4F8); color:#2a323d }
    .gold{   background:linear-gradient(90deg,#F6C866,#FBE6A2); color:#4a3200 }

    /* Soci√°lne siete v rohu */
    .social{
      position:fixed; left:18px; bottom:18px; z-index:5; display:flex; gap:8px
    }
    .soc-btn{
      width:40px; height:40px; border-radius:12px; border:1px solid var(--glass-border);
      background: rgba(10,14,34,.6); color:var(--text); font-weight:900; display:grid; place-items:center; cursor:pointer;
    }

    /* Prefer reduced motion */
    @media (prefers-reduced-motion: reduce){
      .p-ring{ animation:none }
      .btn:hover{ transform:none }
    }

    /* SR-only helper */
    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0 }
  </style>
</head>
<body>
  <!-- Boƒçn√© tlaƒçidlo ZDROJE -->
  <button class="sources-btn" id="btnSources" aria-haspopup="dialog" aria-controls="modalSources">Zdroje</button>

  <div class="container">
    <div class="card" role="application" aria-label="Veda v kocke ‚Äì tri kv√≠zy">
      <header class="app">
        <div class="brand">
          <div class="logo" aria-hidden="true">VVK</div>
          <div>
            <h1>Veda v kocke</h1>
            <div class="sub">Tri port√°ly poznania ‚Äî <strong>Biol√≥gia</strong>, <strong>Fyzika</strong>, <strong>Ch√©mia</strong></div>
          </div>
        </div>
        <div class="sub">Zadaj e‚Äëmail, odomkni port√°ly, sprav ka≈æd√Ω kv√≠z len raz.</div>
      </header>

      <main>
        <!-- ================= HOME (port√°ly + e‚Äëmail + panel progresu) ================= -->
        <section class="home screen active" id="screen-home">
          <div class="intro">
            <p style="margin:0 0 10px">Pou≈æi <strong>ten ist√Ω e‚Äëmail</strong> pre v≈°etky tri kv√≠zy. V√Ωsledky sa k nemu priradia a port√°ly sa podƒæa toho rozsvietia.</p>
            <div class="email-row">
              <label for="email">E‚Äëmail</label>
              <input id="email" name="email" type="email" inputmode="email" placeholder="tvoj@email.sk" autocomplete="email" required />
              <button class="btn" id="btnUseEmail">Pou≈æi≈• e‚Äëmail</button>
              <button class="btn ghost small" id="btnSignOut" title="Odhl√°si≈• aktu√°lny e‚Äëmail" aria-label="Odhl√°si≈•">Odhl√°si≈•</button>
            </div>
          </div>

          <div class="portals" role="list">
            <!-- Biol√≥gia -->
            <button class="portal" id="portal-bio" role="listitem" aria-disabled="true">
              <div class="p-ring ring-bio" aria-hidden="true"></div>
              <div class="lock">HOTOVO üîí</div>
              <div class="info">
                <h3>Biol√≥gia</h3>
                <div class="k-label">≈Ωiv√° pr√≠roda, parazity, telo, spr√°vanie</div>
                <div class="status-badge" id="badge-bio">Neodo mknut√©</div>
              </div>
            </button>

            <!-- Fyzika -->
            <button class="portal" id="portal-fyz" role="listitem" aria-disabled="true">
              <div class="p-ring ring-fyz" aria-hidden="true"></div>
              <div class="lock">HOTOVO üîí</div>
              <div class="info">
                <h3>Fyzika</h3>
                <div class="k-label">Zvuk, teplo, svetlo, pr√≠behy g√©niov</div>
                <div class="status-badge" id="badge-fyz">Neodo mknut√©</div>
              </div>
            </button>

            <!-- Ch√©mia -->
            <button class="portal" id="portal-che" role="listitem" aria-disabled="true">
              <div class="p-ring ring-che" aria-hidden="true"></div>
              <div class="lock">HOTOVO üîí</div>
              <div class="info">
                <h3>Ch√©mia</h3>
                <div class="k-label">L√°tky, molekuly, v√¥ne, lieky</div>
                <div class="status-badge" id="badge-che">Neodo mknut√©</div>
              </div>
            </button>
          </div>

          <div class="progress-panel" id="progressPanel" aria-live="polite">
            <strong>Priebe≈æn√© v√Ωsledky pre: <span id="whoEmail">‚Äî</span></strong>
            <div id="progressList">Zatiaƒæ niƒç nevyplnen√©. Odomkni port√°l a zaƒçni!</div>
          </div>
        </section>

        <!-- ================= KV√çZ (dynamick√Ω podƒæa kateg√≥rie) ================= -->
        <section class="screen" id="screen-quiz" aria-live="polite">
          <div class="qwrap">
            <div class="qhead">
              <div class="qtitle" id="qTitle"></div>
              <div class="step" id="qStep">Ot√°zka 1/6 ‚Ä¢ 0%</div>
            </div>
            <div class="meter" aria-hidden="true"><div class="fill" id="meterFill"></div></div>
            <div class="answers" id="answers" role="list"></div>
            <div class="explain" id="explain">
              <div id="explainText"></div>
              <div class="qfooter">
                <div class="score" id="scoreText">Sk√≥re: 0</div>
                <button class="btn" id="btnNext">ƒéal≈°ia ot√°zka</button>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- ================== MOD√ÅL: √övodn√© upozornenie ================== -->
  <div class="modal" id="modalIntro" role="dialog" aria-modal="true" aria-labelledby="introTitle">
    <div class="box">
      <button class="close-x" data-close="#modalIntro" aria-label="Zavrie≈•">‚úï</button>
      <h2 id="introTitle">Vitaj v dimenzii vedy ‚ú®</h2>
      <p>ƒåakaj√∫ ≈•a <strong>3 kv√≠zy</strong>: Biol√≥gia, Fyzika, Ch√©mia (ka≈æd√Ω po 6 ot√°zok). Pred spusten√≠m zadaj <strong>ten ist√Ω e‚Äëmail</strong>, aby sme vedeli, ktor√© kv√≠zy m√°≈° hotov√© ‚Äî a vedeli odmeni≈• tvoju snahu.</p>
      <ul>
        <li>Ka≈æd√Ω kv√≠z m√¥≈æe≈° urobi≈• <strong>len raz</strong> pre dan√Ω e‚Äëmail.</li>
        <li>Po odpovedi hneƒè uvid√≠≈°, ƒçi bola spr√°vna + kr√°tke vysvetlenie.</li>
        <li>Na hlavnej str√°nke port√°ly ≈æiaria podƒæa tvojej pr√°ce (hotov√© vs. ƒçakaj√∫ce).</li>
      </ul>
      <div style="display:flex; gap:10px; justify-content:flex-end">
        <button class="btn ghost" data-close="#modalIntro">Rozumiem</button>
      </div>
    </div>
  </div>

  <!-- ================== MOD√ÅL: V√Ωsledok ================== -->
  <div class="modal" id="modalResult" role="dialog" aria-modal="true" aria-labelledby="resTitle">
    <div class="box">
      <button class="close-x" data-close="#modalResult" aria-label="Zavrie≈•">‚úï</button>
      <h2 id="resTitle">Hotovo! üéâ</h2>
      <p>Z√≠skal/a si <strong id="finalScore"></strong> bodov z <strong id="totalQ"></strong> (<span id="pct"></span>).</p>
      <div id="tierBadge" class="tier">Bronzov√° √∫rove≈à</div>
      <p id="tierText">Sk√∫s e≈°te raz‚Ä¶ (ale iba s in√Ωm e‚Äëmailom üòâ).</p>
      <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:10px">
        <button class="btn" id="btnBackHome">Nasp√§≈• na hlavn√∫ str√°nku</button>
      </div>
    </div>
  </div>

  <!-- ================== MOD√ÅL: Zdroje ================== -->
  <div class="modal" id="modalSources" role="dialog" aria-modal="true" aria-labelledby="srcTitle">
    <div class="box">
      <button class="close-x" data-close="#modalSources" aria-label="Zavrie≈•">‚úï</button>
      <h2 id="srcTitle">Zdroje k faktom</h2>
      <ul style="line-height:1.6">
        <li><a href="https://aurelstodola.sk/vztah-s-einsteinom/" target="_blank" rel="noopener">aurelstodola.sk ‚Äî vz≈•ah s Einsteinom</a></li>
        <li><a href="https://www.startitup.sk/einstein-ho-oznacil-za-genia-pribeh-slovaka-ktoreho-o-nazor-prosil-i-najznamejsi-fyzik-sveta/" target="_blank" rel="noopener">Startitup ‚Äî Einstein &amp; Stodola</a></li>
        <li><a href="https://pubmed.ncbi.nlm.nih.gov/14749516/" target="_blank" rel="noopener">PubMed ‚Äî green leaf volatiles</a></li>
        <li><a href="https://www.the-scientist.com/designer-microbes-make-painkillers-from-plastic-waste-73110" target="_blank" rel="noopener">The Scientist ‚Äî mikr√≥by &gt; lieky</a></li>
        <li><a href="https://www.nature.com/articles/s41557-025-01845-5" target="_blank" rel="noopener">Nature ‚Äî chemick√° konverzia plastu</a></li>
        <li><a href="https://doi.org/10.1073/pnas.0308037100" target="_blank" rel="noopener">PNAS ‚Äî psilocyb√≠n a terapia</a></li>
        <li><a href="https://www.sciencefocus.com/science/how-many-bananas-would-i-need-to-eat-to-become-radioactive" target="_blank" rel="noopener">Science Focus ‚Äî ban√°ny a r√°dioaktivita</a></li>
        <li><a href="https://www.aktuality.sk/clanok/712624/zenu-uhryzol-najjedovatejsi-pavuk-na-slovensku/" target="_blank" rel="noopener">Aktuality.sk ‚Äî pradiarka pestr√°</a></li>
        <li><a href="https://www.sav.sk/?lang=sk&doc=services-news&source_no=20&news_no=12555" target="_blank" rel="noopener">SAV ‚Äî pav√∫ky na Slovensku</a></li>
        <li><a href="https://bionumbers.hms.harvard.edu/bionumber.aspx?s=n&v=5&id=111126" target="_blank" rel="noopener">BioNumbers ‚Äî plocha tenk√©ho ƒçreva</a></li>
      </ul>
    </div>
  </div>

  <!-- Soci√°lne siete (placeholder odkazy) -->
  <div class="social" aria-label="Soci√°lne siete">
    <a class="soc-btn" href="https://www.instagram.com" target="_blank" rel="noopener" aria-label="Instagram">IG</a>
    <a class="soc-btn" href="https://www.tiktok.com" target="_blank" rel="noopener" aria-label="TikTok">TT</a>
    <a class="soc-btn" href="https://www.youtube.com" target="_blank" rel="noopener" aria-label="YouTube">YT</a>
  </div>

  <script>
    /* ================================================================
       √öLO≈ΩISKO / ‚ÄúAUTH‚Äù
       - localStorage ako jednoduch√Ω per‚Äëdevice register e‚Äëmailov a v√Ωsledkov
       - ≈°trukt√∫ra: vvk_registry = { [email]: { quizzes: { bio|fyz|che: {score,total,ts} } } }
       - vvk_current_email = posledn√Ω pou≈æit√Ω e‚Äëmail (pre UX)
       - Ka≈æd√Ω kv√≠z pre ten ist√Ω e‚Äëmail len raz (blokovanie retake).
       ================================================================ */

    const KEY_REG = 'vvk_registry';
    const KEY_CUR = 'vvk_current_email';

    const $ = sel => document.querySelector(sel);
    const $$ = sel => document.querySelectorAll(sel);

    function loadRegistry(){
      try{ return JSON.parse(localStorage.getItem(KEY_REG) || '{}'); }
      catch{ return {}; }
    }
    function saveRegistry(reg){ localStorage.setItem(KEY_REG, JSON.stringify(reg)); }
    function getEmail(){ return localStorage.getItem(KEY_CUR) || ''; }
    function setEmail(email){ localStorage.setItem(KEY_CUR, email); }
    function signOut(){ localStorage.removeItem(KEY_CUR); }

    function claimEmail(email){
      const reg = loadRegistry();
      if(!reg[email]) reg[email] = { quizzes:{} };
      saveRegistry(reg);
      setEmail(email);
      return reg[email];
    }

    function getRecord(email){
      const reg = loadRegistry(); return reg[email] || null;
    }
    function setResult(email, cat, score, total){
      const reg = loadRegistry();
      if(!reg[email]) reg[email] = { quizzes:{} };
      reg[email].quizzes[cat] = { score, total, ts: Date.now() };
      saveRegistry(reg);
    }

    /* ================================================================
       BACKEND H√ÅƒåIKY ‚Äî voliteƒæn√° integr√°cia (napr. Firebase)
       >>>>>>>>> === TU BUDEM VKLADA≈§ SVOJ K√ìD NA PR√ÅCU S E‚ÄëMAILOM === <<<<<<<<<
       Sem vie≈° doplni≈•:
         - glob√°lnu kontrolu jedineƒçnosti e‚Äëmailu (centr√°lne)
         - ukladanie v√Ωsledkov do cloudu
       Predvolene s√∫ to "no‚Äëop" funkcie, ktor√© sƒæub splnia, ale niƒç nerobia.
       ================================================================ */
    async function backendCheckEmailUnique(email){
      // TODO: over na servery, ƒçi e‚Äëmail e≈°te nebol pou≈æit√Ω (glob√°lne).
      // return { ok:true } alebo { ok:false, reason:'...' }
      return { ok:true };
    }
    async function backendSaveResult({ email, category, score, total }){
      // TODO: ulo≈æi≈• na server / db
      return { ok:true };
    }

    /* ================================================================
       D√ÅTA KV√çZOV
       Ka≈æd√° kateg√≥ria: presne 6 ot√°zok (typ 'tf' = √ÅNO/NIE, 'mc' = v√Ωber)
       >>>>>>>>> === TU BUDEM VKLADA≈§ OT√ÅZKY (mo≈æno upravova≈•) === <<<<<<<<<
       Vopred som doplnil tvoje ot√°zky (5+5+5) a pridal po 1, aby ka≈æd√° mala 6.
       Texty s√∫ skr√°ten√© tak, aby vysvetlenie bolo struƒçn√©; zdroje s√∫ v mod√°li.
       ================================================================ */
    const QUIZZES = {
      bio: {
        name: 'Biol√≥gia',
        portalId: 'portal-bio',
        badgeId: 'badge-bio',
        ringClass: 'ring-bio',
        questions: [
          { type:'tf',
            q:'Existuje huba, ktor√° dok√°≈æe premeni≈• mravce na ‚Äûzombies‚Äú a ovplyv≈àova≈• ich spr√°vanie.',
            options:['√ÅNO','NIE'], correct:0,
            ex:'Ophiocordyceps unilateralis nap√°da nervov√Ω syst√©m mravcov a manipuluje ich spr√°vanie; plodnica potom rozsieva sp√≥ry.' },
          { type:'mc',
            q:'ƒåo sa ti stane, ak ≈•a uhryzne pradiarka pestr√° (najjedovatej≈°√≠ pav√∫k be≈æne v SR)?',
            options:['niƒç, jed nem√° √∫ƒçinok','siln√° boles≈• a≈æ k≈ïƒçe/paral√Ωza','okam≈æit√° smr≈•'],
            correct:1,
            ex:'Uhryznutie je zriedkav√©, ale m√¥≈æe sp√¥sobi≈• siln√∫ boles≈•, k≈ïƒçe a≈æ prechodn√∫ paral√Ωzu; lieƒçiteƒæn√©.' },
          { type:'mc',
            q:'Motolica podivn√° (Leucochloridium) u slim√°kov‚Ä¶',
            options:[
              'larvy vnikn√∫ do oƒç√≠ a pulzovan√≠m l√°kaj√∫ pred√°torov',
              'vybuchne im ≈æal√∫dok',
              'zmen√≠ sa na kyselinu a roztop√≠ mozog'
            ],
            correct:0,
            ex:'Larvy putuj√∫ do oƒçn√Ωch v√Ωbe≈ækov, pulzuj√∫ a vystavuj√∫ slim√°ka vt√°kom; cyklus pokraƒçuje cez vt√°ƒç√≠ trus.' },
          { type:'mc',
            q:'S√°ga stepn√° (najv√§ƒç≈°ia ‚Äûkobylka‚Äú u n√°s) je zauj√≠mav√° t√Ωm, ≈æe‚Ä¶',
            options:[
              'men√≠ farbu ako chamele√≥n',
              'koris≈• lov√≠ ost≈àami na noh√°ch',
              'je prudko jedovat√°'
            ],
            correct:1,
            ex:'S√°ga stepn√° je bezkr√≠dla pred√°torsk√° kobylka; koris≈• pevne dr≈æ√≠ ost≈àami na noh√°ch; patr√≠ medzi najv√§ƒç≈°√≠ hmyz Eur√≥py.' },
          { type:'mc',
            q:'Ak by si rozprestriel povrch tenk√©ho ƒçreva, plocha by zodpovedala pribli≈æne‚Ä¶',
            options:['polovici bedmintonov√©ho kurtu','parkovaciemu miestu','futbalovej lopte'],
            correct:0,
            ex:'Vƒèaka klkom a mikroklkom je plocha obrovsk√° ‚Äì pribli≈æne desiatky m¬≤, ƒçasto sa uv√°dza ~30 m¬≤.' },
          { type:'tf',
            q:'DNA eukaryotick√Ωch buniek je vo v√§ƒç≈°ine pr√≠padov ulo≈æen√° v jadre.',
            options:['√ÅNO','NIE'], correct:0,
            ex:'Eukaryotick√° DNA je v jadre (a ƒças≈• aj v mitochondri√°ch/chloroplastoch); prokaryot√° jadro nemaj√∫.' },
        ]
      },

      fyz: {
        name: 'Fyzika',
        portalId: 'portal-fyz',
        badgeId: 'badge-fyz',
        ringClass: 'ring-fyz',
        questions: [
          { type:'mc',
            q:'Preƒço vlak ‚Äûpoƒçu≈•‚Äú sk√¥r cez koƒæajnice ne≈æ vo vzduchu?',
            options:[
              'p√≠ska staniƒçn√Ω rozhlas',
              'v tuh√Ωch l√°tkach sa zvuk ≈°√≠ri r√Ωchlej≈°ie ne≈æ vo vzduchu',
              'vlak vysiela varovn√Ω sonar'
            ],
            correct:1,
            ex:'ƒåastice kovu s√∫ bl√≠zko pri sebe ‚Üí r√Ωchlej≈°√≠ prenos kmitov; zvuk v koƒæajniciach doraz√≠ sk√¥r.' },
          { type:'tf',
            q:'‚ÄûFarby‚Äú bez pozorovateƒæa neexistuj√∫ ‚Äì s√∫ to len vlnov√© dƒ∫≈æky svetla.',
            options:['√ÅNO','NIE'], correct:0,
            ex:'Svetlo m√° vlnov√∫ dƒ∫≈æku/frekvenciu; farba je z√°≈æitok vytvoren√Ω na≈°√≠m zrakom a mozgom.' },
          { type:'mc',
            q:'Ako kanvica vie, ≈æe m√° vypn√∫≈•?',
            options:[
              '‚Äûpoƒç√∫va‚Äú bublinky a keƒè ich je dos≈•, vypne sa',
              'AI teplomer preru≈°√≠ pr√∫d',
              'bimetalov√Ω p√°sik sa ohnut√≠m rozpoj√≠ kontakt'
            ],
            correct:2,
            ex:'Bimetal (dva kovy s rozdielnou roz≈•a≈ænos≈•ou) sa pri teple ohne a vypne sp√≠naƒç.' },
          { type:'mc',
            q:'ƒåo je najrizikovej≈°ie nad otvorenou r√∫rou?',
            options:[
              'zlat√° retiazka ‚Äì vysok√° tepeln√° vodivos≈•',
              'l√°tkov√° ozdoba ‚Äì ƒæahko vzbƒ∫kne',
              'plastov√° n√°u≈°nica ‚Äì prilep√≠ sa roztaven√≠m'
            ],
            correct:0,
            ex:'Kovy (napr. zlato) ved√∫ teplo v√Ωborne ‚Üí ƒæahko sa rozp√°lia a m√¥≈æu pop√°li≈•.' },
          { type:'tf',
            q:'Aurel Stodola bol obdivovan√Ω Einsteinom.',
            options:['√ÅNO','NIE'], correct:0,
            ex:'Stodola (parn√© stroje, turb√≠ny) uƒçil v Z√ºrichu; s Einsteinom mal bl√≠zky kontakt a re≈°pekt.' },
          { type:'tf',
            q:'Opaƒæovanie (UV) je ‚Äûbezpeƒçnej≈°ie‚Äú ne≈æ 5G r√°diov√© vlny.',
            options:['√ÅNO','NIE'], correct:1,
            ex:'UV je ionizuj√∫ce a po≈°kodzuje DNA; 5G je neionizuj√∫ce s ni≈æ≈°ou energiou fot√≥nov.' },
        ]
      },

      che: {
        name: 'Ch√©mia',
        portalId: 'portal-che',
        badgeId: 'badge-che',
        ringClass: 'ring-che',
        questions: [
          { type:'tf',
            q:'V√¥≈àa pokosenej tr√°vy je chemick√Ω sign√°l varovania pre ƒèal≈°ie rastliny.',
            options:['√ÅNO','NIE'], correct:0,
            ex:'‚ÄûGreen leaf volatiles‚Äú upozor≈àuj√∫ okolie na stres/po≈°kodenie a sp√∫≈°≈•aj√∫ obrann√© reakcie.' },
          { type:'tf',
            q:'Kofe√≠n ‚Äûdod√°va‚Äú energiu t√Ωm, ≈æe ju vyrob√≠ naviac.',
            options:['√ÅNO','NIE'], correct:1,
            ex:'Kofe√≠n blokuje adenoz√≠nov√© receptory (√∫navov√© sign√°ly) a men√≠ vn√≠manie; energiu s√°m nevyr√°ba.' },
          { type:'mc',
            q:'Vedci vyvinuli mikr√≥by, ktor√© zlo≈æky z PET plastu premenia na‚Ä¶',
            options:['ƒçiernu dieru','√∫ƒçinn√Ω paracetamol','≈æelezn√∫ rudu'],
            correct:1,
            ex:'Syntetick√° biol√≥gia umo≈æ≈àuje premeni≈• produkty rozkladu PET na farmaceutik√° (napr. paracetamol).' },
          { type:'mc',
            q:'Psilocyb√≠n z ‚Äûhalucinog√©nnych‚Äú h√∫b sa sk√∫ma najm√§ pre‚Ä¶',
            options:['lep≈°iu komunik√°ciu','orient√°ciu v priestore','pomoc pri √∫zkosti/depresii'],
            correct:2,
            ex:'Pod dohƒæadom odborn√≠kov m√¥≈æe zlep≈°i≈• sympt√≥my depresie/√∫zkosti; prebiehaj√∫ klinick√© ≈°t√∫die.' },
          { type:'mc',
            q:'Ban√°ny obsahuj√∫ stopov√© mno≈æstvo prvku, vƒèaka ktor√©mu s√∫‚Ä¶',
            options:['liekom na zlomeniny','mierne r√°dioakt√≠vne','≈ælt√©'],
            correct:1,
            ex:'Izotop K‚Äë40 je prirodzene pr√≠tomn√Ω; d√°vky s√∫ extr√©mne mal√© a ne≈°kodn√©.' },
          { type:'tf',
            q:'Molekula vody (H‚ÇÇO) je pol√°rna ‚Äî preto v√Ωborne rozp√∫≈°≈•a i√≥nov√©/pol√°rne l√°tky.',
            options:['√ÅNO','NIE'], correct:0,
            ex:'Asymetrick√© rozdelenie n√°boja d√°va vode dip√≥l; to je z√°klad jej ‚Äûchemickej v≈°estrannosti‚Äú.' },
        ]
      }
    };

    /* ================================================================
       STAV KV√çZU & UI prepojenie
       ================================================================ */
    const elHome   = $('#screen-home');
    const elQuiz   = $('#screen-quiz');
    const elTitle  = $('#qTitle');
    const elStep   = $('#qStep');
    const elMeter  = $('#meterFill');
    const elAns    = $('#answers');
    const elExpl   = $('#explain');
    const elExplTx = $('#explainText');
    const elScore  = $('#scoreText');

    const elEmail  = $('#email');
    const elUse    = $('#btnUseEmail');
    const elOut    = $('#btnSignOut');

    const elPortBio = $('#portal-bio');
    const elPortFyz = $('#portal-fyz');
    const elPortChe = $('#portal-che');

    const elBadgeBio = $('#badge-bio');
    const elBadgeFyz = $('#badge-fyz');
    const elBadgeChe = $('#badge-che');

    const elPanelWho = $('#whoEmail');
    const elProgList = $('#progressList');

    const modalIntro   = $('#modalIntro');
    const modalResult  = $('#modalResult');
    const modalSources = $('#modalSources');

    const btnSources = $('#btnSources');
    const btnNext    = $('#btnNext');
    const btnBackHome= $('#btnBackHome');

    let session = {
      email: '',
      cat: '',
      idx: 0,
      score: 0,
      answered: false,
      list: []  // aktu√°lne ot√°zky
    };

    /* ---------- pomocn√© UI ---------- */
    function showScreen(which){
      [elHome, elQuiz].forEach(s => s.classList.remove('active'));
      if(which === 'home') elHome.classList.add('active');
      if(which === 'quiz') elQuiz.classList.add('active');
    }
    function openModal(m){ m.classList.add('active'); trapFocus(m); }
    function closeModal(m){ m.classList.remove('active'); releaseFocus(); }

    // jednoduch√Ω trap focus pre pr√≠stupnos≈•
    let lastFocus = null;
    function trapFocus(modal){
      lastFocus = document.activeElement;
      const focusables = modal.querySelectorAll('button, [href], input, [tabindex]:not([tabindex="-1"])');
      const first = focusables[0], last = focusables[focusables.length-1];
      modal.addEventListener('keydown', modal._key = (e)=>{
        if(e.key==='Escape'){ closeModal(modal); }
        if(e.key!=='Tab') return;
        if(e.shiftKey && document.activeElement===first){ e.preventDefault(); last.focus(); }
        else if(!e.shiftKey && document.activeElement===last){ e.preventDefault(); first.focus(); }
      });
      setTimeout(()=> first?.focus(), 0);
    }
    function releaseFocus(){
      if(!lastFocus) return;
      const modal = document.querySelector('.modal.active');
      if(modal){ modal.removeEventListener('keydown', modal._key); }
      lastFocus.focus();
    }

    /* ---------- e‚Äëmail & port√°ly ---------- */
    async function useEmail(){
      const email = elEmail.value.trim().toLowerCase();
      const ok = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      if(!ok){ alert('Zadaj platn√Ω e‚Äëmail.'); return; }

      // voliteƒæne over jedineƒçnos≈• (online)
      const check = await backendCheckEmailUnique(email);
      if(!check.ok){
        alert(check.reason || 'Tento e‚Äëmail u≈æ bol pou≈æit√Ω.');
        return;
      }

      claimEmail(email);
      session.email = email;
      renderHome();
    }

    function renderHome(){
      // aktivuj port√°ly a uk√°≈æ stav
      const email = getEmail();
      session.email = email || '';
      elPanelWho.textContent = email || '‚Äî';
      elEmail.value = email || '';

      const rec = email ? getRecord(email) : null;

      // helper: nastavi≈• port√°l
      const setPortal = (btn, badge, cat, ringClass) =>{
        const done = !!rec?.quizzes?.[cat];
        btn.setAttribute('aria-disabled', !email ? 'true' : 'false');
        btn.classList.toggle('done', !!done);
        badge.textContent = !email ? 'Neodomknut√©' : (done ? `Hotovo: ${rec.quizzes[cat].score}/${rec.quizzes[cat].total}` : 'Pripraven√©');
        badge.classList.toggle('done', !!done);
      };

      setPortal(elPortBio, elBadgeBio, 'bio', 'ring-bio');
      setPortal(elPortFyz, elBadgeFyz, 'fyz', 'ring-fyz');
      setPortal(elPortChe, elBadgeChe, 'che', 'ring-che');

      // panel zoznam
      if(!email){
        elProgList.textContent = 'Zatiaƒæ niƒç nevyplnen√©. Odomkni port√°l a zaƒçni!';
      } else if(!rec || !rec.quizzes || Object.keys(rec.quizzes).length === 0){
        elProgList.textContent = '≈Ωiadne dokonƒçen√© kv√≠zy. Vyber si port√°l!';
      } else {
        const lines = ['Prehƒæad:'];
        for(const k of ['bio','fyz','che']){
          const r = rec.quizzes[k];
          lines.push(`${QUIZZES[k].name}: ${r ? (r.score + '/' + r.total) : '‚Äî'}`);
        }
        elProgList.textContent = lines.join(' | ');
      }
    }

    function attachPortal(btn, cat){
      btn.addEventListener('click', ()=>{
        const email = getEmail();
        if(!email){ alert('Najprv zadaj a potvrƒè e‚Äëmail.'); return; }
        const rec = getRecord(email);
        const done = !!rec?.quizzes?.[cat];
        if(done){
          const r = rec.quizzes[cat];
          alert(`Tento kv√≠z u≈æ m√°≈° hotov√Ω.\nV√Ωsledok: ${r.score}/${r.total}`);
          return;
        }
        startQuiz(cat);
      });
    }

    /* ---------- logika kv√≠zu ---------- */
    function startQuiz(cat){
      const pack = QUIZZES[cat];
      session.cat = cat;
      session.idx = 0;
      session.score = 0;
      session.answered = false;
      session.list = pack.questions.slice(); // k√≥pia

      showScreen('quiz');
      renderQuestion();
    }

    function renderQuestion(){
      const q = session.list[session.idx];
      const total = session.list.length;

      elTitle.textContent = `${session.idx+1}. ${q.q}`;
      elAns.innerHTML = '';
      elExpl.classList.remove('active');
      session.answered = false;

      // layout √ÅNO/NIE = dve veƒæk√© tlaƒçidl√°
      elAns.className = 'answers' + (q.type==='tf' ? ' two' : '');

      const options = q.type==='tf' ? [{key:'√ÅNO', text:'√ÅNO'}, {key:'NIE', text:'NIE'}]
                                    : q.options.map((t,i)=>({key:String.fromCharCode(65+i), text:t}));

      options.forEach((opt, i)=>{
        const btn = document.createElement('button');
        btn.className = 'opt' + (q.type==='tf' ? ' big' : '');
        btn.setAttribute('role','listitem');
        btn.innerHTML = (q.type==='tf' ? '' : `<span class="key">${opt.key}</span>`) + opt.text;
        btn.addEventListener('click', ()=> selectAnswer(q, i));
        btn.addEventListener('keyup', (e)=>{ if(e.key==='Enter' || e.key===' ') selectAnswer(q, i); });
        elAns.appendChild(btn);
      });

      // krok + percent√°
      const pct = Math.round((session.idx / total) * 100);
      elStep.textContent = `Ot√°zka ${session.idx+1}/${total} ‚Ä¢ ${pct}%`;
      elMeter.style.width = `${pct}%`;
      elScore.textContent = `Sk√≥re: ${session.score}`;
    }

    function selectAnswer(q, i){
      if(session.answered) return;
      const nodes = [...elAns.children];
      nodes.forEach(n=> n.disabled = true);

      const correctIndex = (q.type==='tf')
        ? (q.options ? q.correct : q.correct) // kompatibilita
        : q.correct;

      const hit = i === correctIndex;
      if(hit){
        session.score++;
        nodes[i].classList.add('correct');
        nodes[i].setAttribute('data-tag','SPR√ÅVNE');
      } else {
        nodes[i].classList.add('wrong');
        nodes[i].setAttribute('data-tag','NESPR√ÅVNE');
        // zv√Ωrazni spr√°vnu
        const ci = correctIndex;
        if(nodes[ci]){
          nodes[ci].classList.add('correct');
          nodes[ci].setAttribute('data-tag','SPR√ÅVNA');
        }
      }

      elExplTx.textContent = q.ex || '';
      elExpl.classList.add('active');
      session.answered = true;

      // posun progressu (po zodpovedan√≠)
      const total = session.list.length;
      const pct = Math.round(((session.idx+1) / total) * 100);
      elStep.textContent = `Ot√°zka ${session.idx+1}/${total} ‚Ä¢ ${pct}%`;
      elMeter.style.width = `${pct}%`;

      // UX: fokus na ‚Äûƒéal≈°ia ot√°zka‚Äù
      btnNext.focus();
    }

    btnNext.addEventListener('click', ()=>{
      if(!session.answered){ alert('Najprv vyber odpoveƒè.'); return; }
      session.idx++;
      if(session.idx >= session.list.length){
        finishQuiz();
      } else {
        renderQuestion();
      }
    });

    async function finishQuiz(){
      const total = session.list.length;
      const score = session.score;

      // ulo≈æi≈• lok√°lne + (voliteƒæne) na backend
      setResult(session.email, session.cat, score, total);
      await backendSaveResult({ email: session.email, category: session.cat, score, total });

      // vyhodnotenie
      const ratio = score/total;
      $('#finalScore').textContent = score;
      $('#totalQ').textContent = total;
      $('#pct').textContent = `${Math.round(ratio*100)}%`;

      const badge = $('#tierBadge'); const text = $('#tierText');
      if(ratio >= .84){ badge.textContent='Zlat√° √∫rove≈à'; badge.className='tier gold'; text.textContent='≈†piƒçkov√Ω v√Ωkon! Zlat√° √∫rove≈à ≈æiari ‚ú®'; }
      else if(ratio >= .5){ badge.textContent='Strieborn√° √∫rove≈à'; badge.className='tier silver'; text.textContent='V√Ωborne! E≈°te k√∫sok k zlatu.'; }
      else { badge.textContent='Bronzov√° √∫rove≈à'; badge.className='tier'; text.textContent='Bronz je len zaƒçiatok. D√°≈° to nabud√∫ce!' }

      openModal(modalResult);
    }

    btnBackHome.addEventListener('click', ()=>{
      closeModal(modalResult);
      showScreen('home');
      renderHome();
      // fokus sp√§≈• na port√°l danej kateg√≥rie
      const p = QUIZZES[session.cat]?.portalId;
      if(p) document.getElementById(p).focus();
    });

    /* ---------- init / eventy ---------- */
    // Port√°ly (click handlers)
    attachPortal(elPortBio, 'bio');
    attachPortal(elPortFyz, 'fyz');
    attachPortal(elPortChe, 'che');

    // E‚Äëmail
    elUse.addEventListener('click', useEmail);
    elEmail.addEventListener('keydown', e=>{ if(e.key==='Enter') useEmail(); });
    elOut.addEventListener('click', ()=>{ signOut(); renderHome(); });

    // Mod√°ly: close tlaƒçidl√°
    document.addEventListener('click', (e)=>{
      const t = e.target.closest('[data-close]');
      if(!t) return;
      const sel = t.getAttribute('data-close');
      const m = document.querySelector(sel);
      if(m) closeModal(m);
    });
    // Zdroje
    btnSources.addEventListener('click', ()=> openModal(modalSources));

    // Spusti≈• ‚Äî predvyplni≈• e‚Äëmail, zobrazi≈• intro iba raz za session
    window.addEventListener('DOMContentLoaded', ()=>{
      const saved = getEmail();
      if(saved){ elEmail.value = saved; }
      renderHome();
      // intro pri prvom naƒç√≠tan√≠
      if(!sessionStorage.getItem('vvk_intro_seen')){
        openModal(modalIntro);
        sessionStorage.setItem('vvk_intro_seen','1');
      }
    });
  </script>
</body>
</
